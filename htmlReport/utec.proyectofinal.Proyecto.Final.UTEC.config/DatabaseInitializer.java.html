<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DatabaseInitializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.config</a> &gt; <span class="el_source">DatabaseInitializer.java</span></div><h1>DatabaseInitializer.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.core.annotation.Order;
import org.springframework.stereotype.Component;
import utec.proyectofinal.Proyecto.Final.UTEC.business.repositories.UsuarioRepository;
import utec.proyectofinal.Proyecto.Final.UTEC.enums.Rol;
import utec.proyectofinal.Proyecto.Final.UTEC.services.UsuarioService;

/**
 * Inicializador de datos base del sistema.
 * Crea el usuario administrador predeterminado si no existe.
 */
@Component
@Order(1) // Se ejecuta primero
<span class="fc" id="L17">public class DatabaseInitializer implements CommandLineRunner {</span>

    @Autowired
    private UsuarioRepository usuarioRepository;

    @Autowired
    private UsuarioService usuarioService;

    @Override
    public void run(String... args) throws Exception {
<span class="fc" id="L27">        initializeDefaultAdmin();</span>
<span class="fc" id="L28">    }</span>

    private void initializeDefaultAdmin() {
        try {
            // Verificar si ya existe al menos un admin en el sistema
<span class="pc bpc" id="L33" title="1 of 2 branches missed.">            if (!usuarioRepository.existsByRol(Rol.ADMIN)) {</span>
<span class="fc" id="L34">                System.out.println(&quot;\nüîß No se encontr√≥ ning√∫n administrador en el sistema&quot;);</span>
<span class="fc" id="L35">                System.out.println(&quot;üìù Creando administrador predeterminado con 2FA...\n&quot;);</span>
                
<span class="fc" id="L37">                usuarioService.crearAdminPredeterminado();</span>
                
                // El m√©todo crearAdminPredeterminado ya muestra toda la informaci√≥n necesaria
<span class="fc" id="L40">            } else {</span>
<span class="nc" id="L41">                System.out.println(&quot;‚ÑπÔ∏è  Ya existe al menos un administrador en el sistema&quot;);</span>
            }
<span class="nc" id="L43">        } catch (Exception e) {</span>
<span class="nc" id="L44">            System.err.println(&quot;‚ùå Error al inicializar admin predeterminado: &quot; + e.getMessage());</span>
<span class="nc" id="L45">            e.printStackTrace();</span>
        }
<span class="fc" id="L47">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>