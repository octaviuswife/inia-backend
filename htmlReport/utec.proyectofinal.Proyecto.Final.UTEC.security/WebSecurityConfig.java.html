<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebSecurityConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.security</a> &gt; <span class="el_source">WebSecurityConfig.java</span></div><h1>WebSecurityConfig.java</h1><pre class="source lang-java linenums">
package utec.proyectofinal.Proyecto.Final.UTEC.security;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * @author Usuario
 */
@EnableMethodSecurity(prePostEnabled = true)
@EnableWebSecurity
@Configuration
<span class="fc" id="L23">public class WebSecurityConfig {</span>

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
<span class="fc" id="L27">        http.cors(Customizer.withDefaults())</span>
<span class="fc" id="L28">                .csrf(csrf -&gt; csrf.disable())</span>
<span class="fc" id="L29">                .addFilterBefore(new FiltroJWTAutorizacion(), UsernamePasswordAuthenticationFilter.class)</span>
<span class="fc" id="L30">                .authorizeHttpRequests(auth -&gt; auth</span>
                        // Endpoints públicos (sin autenticación)
<span class="fc" id="L32">                        .requestMatchers(&quot;/api/v1/auth/**&quot;).permitAll()</span>
<span class="fc" id="L33">                        .requestMatchers(&quot;/swagger-ui.html&quot;).permitAll()</span>
<span class="fc" id="L34">                        .requestMatchers(&quot;/webjars/**&quot;).permitAll()</span>
<span class="fc" id="L35">                        .requestMatchers(&quot;/swagger-ui/**&quot;).permitAll()</span>
<span class="fc" id="L36">                        .requestMatchers(&quot;/v3/api-docs/**&quot;).permitAll()</span>
<span class="fc" id="L37">                        .requestMatchers(&quot;/swagger-resources/**&quot;).permitAll()</span>
<span class="fc" id="L38">                        .requestMatchers(&quot;/configuration/**&quot;).permitAll()</span>

                        /*
                        // LECTURA - Todos los roles autenticados pueden ver
                        .requestMatchers(HttpMethod.GET, &quot;/api/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;, &quot;OBSERVADOR&quot;)

                        // CREACIÓN Y EDICIÓN - Solo ADMIN y ANALISTA
                        .requestMatchers(HttpMethod.POST, &quot;/api/germinacion/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/api/tetrazolio/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/api/pureza/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)
                        .requestMatchers(HttpMethod.PUT, &quot;/api/germinacion/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)
                        .requestMatchers(HttpMethod.PUT, &quot;/api/tetrazolio/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)
                        .requestMatchers(HttpMethod.PUT, &quot;/api/pureza/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;ANALISTA&quot;)

                        // ELIMINACIÓN - Solo ADMIN
                        .requestMatchers(HttpMethod.DELETE, &quot;/api/**&quot;).hasRole(&quot;ADMIN&quot;)

                        // GESTIÓN DE USUARIOS - Solo ADMIN
                        .requestMatchers(&quot;/api/usuarios/**&quot;).hasRole(&quot;ADMIN&quot;)
                        */
                        // DESARROLLO: Cambiar a authenticated() para que funcione JWT
<span class="fc" id="L59">                        .anyRequest().authenticated());</span>




<span class="fc" id="L64">        return http.build();</span>
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
<span class="fc" id="L69">        return new BCryptPasswordEncoder();</span>
    }

    @Bean
    public WebMvcConfigurer configurarCorsGlobal() {
<span class="fc" id="L74">        return new WebMvcConfigurer() {</span>
            @Override
            public void addCorsMappings(CorsRegistry registry) {
<span class="fc" id="L77">                registry.addMapping(&quot;/api/**&quot;)</span>
<span class="fc" id="L78">                        .allowedOrigins(&quot;http://localhost:3000&quot;) // Dominio específico del frontend</span>
<span class="fc" id="L79">                        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;PATCH&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)</span>
<span class="fc" id="L80">                        .allowedHeaders(&quot;*&quot;)</span>
<span class="fc" id="L81">                        .allowCredentials(true); // CRÍTICO: permite enviar cookies desde el frontend</span>
<span class="fc" id="L82">            }</span>
        };
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>