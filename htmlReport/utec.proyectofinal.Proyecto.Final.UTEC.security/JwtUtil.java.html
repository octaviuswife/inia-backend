<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JwtUtil.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.security</a> &gt; <span class="el_source">JwtUtil.java</span></div><h1>JwtUtil.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.security;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import org.springframework.stereotype.Component;
import utec.proyectofinal.Proyecto.Final.UTEC.business.entities.Usuario;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.util.Date;
import java.util.List;

@Component
<span class="fc" id="L15">public class JwtUtil {</span>

<span class="fc" id="L17">    private final String CLAVE = &quot;@Z9@vQ3!pL8#wX7^tR2&amp;nG6*yM4$eB1(dF0)sH5%kJ3&amp;uY8*rE4#wQ1@zX6^nM9$&quot;;</span>
<span class="fc" id="L18">    private final SecretKey secretKey = Keys.hmacShaKeyFor(CLAVE.getBytes(StandardCharsets.UTF_8));</span>
<span class="fc" id="L19">    private final long ACCESS_TOKEN_EXPIRATION = 3600000; // 1 hora en milisegundos</span>
<span class="fc" id="L20">    private final long REFRESH_TOKEN_EXPIRATION = 604800000; // 7 d√≠as en milisegundos</span>

    public String generarToken(Usuario usuario, List&lt;String&gt; roles) {
<span class="fc" id="L23">        Date ahora = new Date();</span>
<span class="fc" id="L24">        Date expiracion = new Date(ahora.getTime() + ACCESS_TOKEN_EXPIRATION);</span>

<span class="fc" id="L26">        return Jwts.builder()</span>
<span class="fc" id="L27">                .setSubject(usuario.getNombre())</span>
<span class="fc" id="L28">                .claim(&quot;authorities&quot;, roles)</span>
<span class="fc" id="L29">                .claim(&quot;userId&quot;, usuario.getUsuarioID())</span>
<span class="fc" id="L30">                .claim(&quot;email&quot;, usuario.getEmail())</span>
<span class="fc" id="L31">                .claim(&quot;nombres&quot;, usuario.getNombres())</span>
<span class="fc" id="L32">                .claim(&quot;apellidos&quot;, usuario.getApellidos())</span>
<span class="fc" id="L33">                .claim(&quot;type&quot;, &quot;access&quot;)</span>
<span class="fc" id="L34">                .setIssuedAt(ahora)</span>
<span class="fc" id="L35">                .setExpiration(expiracion)</span>
<span class="fc" id="L36">                .signWith(secretKey, SignatureAlgorithm.HS256)</span>
<span class="fc" id="L37">                .compact();</span>
    }

    public String generarRefreshToken(Usuario usuario) {
<span class="fc" id="L41">        Date ahora = new Date();</span>
<span class="fc" id="L42">        Date expiracion = new Date(ahora.getTime() + REFRESH_TOKEN_EXPIRATION);</span>

<span class="fc" id="L44">        return Jwts.builder()</span>
<span class="fc" id="L45">                .setSubject(usuario.getNombre())</span>
<span class="fc" id="L46">                .claim(&quot;userId&quot;, usuario.getUsuarioID())</span>
<span class="fc" id="L47">                .claim(&quot;type&quot;, &quot;refresh&quot;)</span>
<span class="fc" id="L48">                .setIssuedAt(ahora)</span>
<span class="fc" id="L49">                .setExpiration(expiracion)</span>
<span class="fc" id="L50">                .signWith(secretKey, SignatureAlgorithm.HS256)</span>
<span class="fc" id="L51">                .compact();</span>
    }

    public boolean esTokenValido(String token) {
        try {
<span class="fc" id="L56">            Jwts.parser()</span>
<span class="fc" id="L57">                    .verifyWith(secretKey)</span>
<span class="fc" id="L58">                    .build()</span>
<span class="fc" id="L59">                    .parseSignedClaims(token);</span>
<span class="fc" id="L60">            return true;</span>
<span class="fc" id="L61">        } catch (Exception e) {</span>
<span class="fc" id="L62">            return false;</span>
        }
    }

    public String obtenerUsuarioDelToken(String token) {
<span class="fc" id="L67">        return Jwts.parser()</span>
<span class="fc" id="L68">                .verifyWith(secretKey)</span>
<span class="fc" id="L69">                .build()</span>
<span class="fc" id="L70">                .parseSignedClaims(token)</span>
<span class="fc" id="L71">                .getPayload()</span>
<span class="fc" id="L72">                .getSubject();</span>
    }

    public Integer obtenerUserIdDelToken(String token) {
<span class="fc" id="L76">        return Jwts.parser()</span>
<span class="fc" id="L77">                .verifyWith(secretKey)</span>
<span class="fc" id="L78">                .build()</span>
<span class="fc" id="L79">                .parseSignedClaims(token)</span>
<span class="fc" id="L80">                .getPayload()</span>
<span class="fc" id="L81">                .get(&quot;userId&quot;, Integer.class);</span>
    }

    public String obtenerTipoToken(String token) {
<span class="nc" id="L85">        return Jwts.parser()</span>
<span class="nc" id="L86">                .verifyWith(secretKey)</span>
<span class="nc" id="L87">                .build()</span>
<span class="nc" id="L88">                .parseSignedClaims(token)</span>
<span class="nc" id="L89">                .getPayload()</span>
<span class="nc" id="L90">                .get(&quot;type&quot;, String.class);</span>
    }

    public long getAccessTokenExpiration() {
<span class="fc" id="L94">        return ACCESS_TOKEN_EXPIRATION;</span>
    }

    public long getRefreshTokenExpiration() {
<span class="fc" id="L98">        return REFRESH_TOKEN_EXPIRATION;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>