<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContactoServiceTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.services</a> &gt; <span class="el_source">ContactoServiceTest.java</span></div><h1>ContactoServiceTest.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.services;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;

import utec.proyectofinal.Proyecto.Final.UTEC.business.entities.Contacto;
import utec.proyectofinal.Proyecto.Final.UTEC.business.repositories.ContactoRepository;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.request.ContactoRequestDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.response.ContactoDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.enums.TipoContacto;

import java.util.Arrays;
import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyLong;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.*;

@ExtendWith(MockitoExtension.class)
@org.mockito.junit.jupiter.MockitoSettings(strictness = org.mockito.quality.Strictness.LENIENT)
@DisplayName(&quot;Tests de ContactoService&quot;)
<span class="fc" id="L34">class ContactoServiceTest {</span>

    @Mock
    private ContactoRepository contactoRepository;

    @InjectMocks
    private ContactoService contactoService;

    private ContactoRequestDTO contactoRequestDTO;
    private Contacto contacto;
    private Contacto empresa;

    @BeforeEach
    void setUp() {
<span class="fc" id="L48">        contactoRequestDTO = new ContactoRequestDTO();</span>
<span class="fc" id="L49">        contactoRequestDTO.setNombre(&quot;Juan Pérez&quot;);</span>
<span class="fc" id="L50">        contactoRequestDTO.setContacto(&quot;juan@example.com&quot;);</span>
<span class="fc" id="L51">        contactoRequestDTO.setTipo(TipoContacto.CLIENTE);</span>

<span class="fc" id="L53">        contacto = new Contacto();</span>
<span class="fc" id="L54">        contacto.setContactoID(1L);</span>
<span class="fc" id="L55">        contacto.setNombre(&quot;Juan Pérez&quot;);</span>
<span class="fc" id="L56">        contacto.setContacto(&quot;juan@example.com&quot;);</span>
<span class="fc" id="L57">        contacto.setTipo(TipoContacto.CLIENTE);</span>
<span class="fc" id="L58">        contacto.setActivo(true);</span>

<span class="fc" id="L60">        empresa = new Contacto();</span>
<span class="fc" id="L61">        empresa.setContactoID(2L);</span>
<span class="fc" id="L62">        empresa.setNombre(&quot;Empresa SA&quot;);</span>
<span class="fc" id="L63">        empresa.setContacto(&quot;empresa@example.com&quot;);</span>
<span class="fc" id="L64">        empresa.setTipo(TipoContacto.EMPRESA);</span>
<span class="fc" id="L65">        empresa.setActivo(true);</span>
<span class="fc" id="L66">    }</span>

    @Test
    @DisplayName(&quot;Obtener todos los contactos activos - debe retornar lista&quot;)
    void obtenerTodosLosContactos_debeRetornarLista() {
<span class="fc" id="L71">        when(contactoRepository.findByActivoTrue()).thenReturn(Arrays.asList(contacto, empresa));</span>

<span class="fc" id="L73">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerTodosLosContactos();</span>

<span class="fc" id="L75">        assertNotNull(resultado);</span>
<span class="fc" id="L76">        assertEquals(2, resultado.size());</span>
<span class="fc" id="L77">        verify(contactoRepository, times(1)).findByActivoTrue();</span>
<span class="fc" id="L78">    }</span>

    @Test
    @DisplayName(&quot;Obtener contactos por tipo - debe retornar solo clientes&quot;)
    void obtenerContactosPorTipo_debeRetornarSoloClientes() {
<span class="fc" id="L83">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.CLIENTE)).thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L85">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPorTipo(TipoContacto.CLIENTE);</span>

<span class="fc" id="L87">        assertNotNull(resultado);</span>
<span class="fc" id="L88">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L89">        assertEquals(TipoContacto.CLIENTE, resultado.get(0).getTipo());</span>
<span class="fc" id="L90">        verify(contactoRepository, times(1)).findByTipoAndActivoTrue(TipoContacto.CLIENTE);</span>
<span class="fc" id="L91">    }</span>

    @Test
    @DisplayName(&quot;Obtener clientes - debe retornar solo clientes activos&quot;)
    void obtenerClientes_debeRetornarSoloClientes() {
<span class="fc" id="L96">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.CLIENTE)).thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L98">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerClientes();</span>

<span class="fc" id="L100">        assertNotNull(resultado);</span>
<span class="fc" id="L101">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L102">        assertEquals(TipoContacto.CLIENTE, resultado.get(0).getTipo());</span>
<span class="fc" id="L103">    }</span>

    @Test
    @DisplayName(&quot;Obtener empresas - debe retornar solo empresas activas&quot;)
    void obtenerEmpresas_debeRetornarSoloEmpresas() {
<span class="fc" id="L108">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.EMPRESA)).thenReturn(Arrays.asList(empresa));</span>

<span class="fc" id="L110">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerEmpresas();</span>

<span class="fc" id="L112">        assertNotNull(resultado);</span>
<span class="fc" id="L113">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L114">        assertEquals(TipoContacto.EMPRESA, resultado.get(0).getTipo());</span>
<span class="fc" id="L115">    }</span>

    @Test
    @DisplayName(&quot;Obtener contacto por ID - debe retornar contacto existente&quot;)
    void obtenerContactoPorId_contactoExistente_debeRetornarContacto() {
<span class="fc" id="L120">        when(contactoRepository.findByContactoIDAndActivoTrue(1L)).thenReturn(Optional.of(contacto));</span>

<span class="fc" id="L122">        ContactoDTO resultado = contactoService.obtenerContactoPorId(1L);</span>

<span class="fc" id="L124">        assertNotNull(resultado);</span>
<span class="fc" id="L125">        assertEquals(1L, resultado.getContactoID());</span>
<span class="fc" id="L126">        assertEquals(&quot;Juan Pérez&quot;, resultado.getNombre());</span>
<span class="fc" id="L127">        verify(contactoRepository, times(1)).findByContactoIDAndActivoTrue(1L);</span>
<span class="fc" id="L128">    }</span>

    @Test
    @DisplayName(&quot;Obtener contacto por ID inexistente - debe lanzar excepción&quot;)
    void obtenerContactoPorId_contactoInexistente_debeLanzarExcepcion() {
<span class="fc" id="L133">        when(contactoRepository.findByContactoIDAndActivoTrue(999L)).thenReturn(Optional.empty());</span>

<span class="fc" id="L135">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L136">            contactoService.obtenerContactoPorId(999L);</span>
<span class="nc" id="L137">        });</span>

<span class="fc" id="L139">        assertTrue(exception.getMessage().contains(&quot;no encontrado&quot;));</span>
<span class="fc" id="L140">    }</span>

    @Test
    @DisplayName(&quot;Crear contacto válido - debe guardar y retornar DTO&quot;)
    void crearContacto_valido_debeGuardarYRetornarDTO() {
<span class="fc" id="L145">        when(contactoRepository.existsByNombreIgnoreCaseAndTipo(anyString(), any(TipoContacto.class))).thenReturn(false);</span>
<span class="fc" id="L146">        when(contactoRepository.save(any(Contacto.class))).thenReturn(contacto);</span>

<span class="fc" id="L148">        ContactoDTO resultado = contactoService.crearContacto(contactoRequestDTO);</span>

<span class="fc" id="L150">        assertNotNull(resultado);</span>
<span class="fc" id="L151">        assertEquals(&quot;Juan Pérez&quot;, resultado.getNombre());</span>
<span class="fc" id="L152">        verify(contactoRepository, times(1)).save(any(Contacto.class));</span>
<span class="fc" id="L153">    }</span>

    @Test
    @DisplayName(&quot;Crear contacto con nombre duplicado - debe lanzar excepción&quot;)
    void crearContacto_nombreDuplicado_debeLanzarExcepcion() {
<span class="fc" id="L158">        when(contactoRepository.existsByNombreIgnoreCaseAndTipo(anyString(), any(TipoContacto.class))).thenReturn(true);</span>

<span class="fc" id="L160">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L161">            contactoService.crearContacto(contactoRequestDTO);</span>
<span class="nc" id="L162">        });</span>

<span class="fc" id="L164">        assertTrue(exception.getMessage().contains(&quot;Ya existe&quot;));</span>
<span class="fc" id="L165">        verify(contactoRepository, never()).save(any(Contacto.class));</span>
<span class="fc" id="L166">    }</span>

    @Test
    @DisplayName(&quot;Crear contacto sin nombre - debe lanzar excepción&quot;)
    void crearContacto_sinNombre_debeLanzarExcepcion() {
<span class="fc" id="L171">        contactoRequestDTO.setNombre(&quot;&quot;);</span>

<span class="fc" id="L173">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L174">            contactoService.crearContacto(contactoRequestDTO);</span>
<span class="nc" id="L175">        });</span>

<span class="fc" id="L177">        assertTrue(exception.getMessage().contains(&quot;requerido&quot;));</span>
<span class="fc" id="L178">        verify(contactoRepository, never()).save(any(Contacto.class));</span>
<span class="fc" id="L179">    }</span>

    @Test
    @DisplayName(&quot;Actualizar contacto - debe actualizar y retornar DTO&quot;)
    void actualizarContacto_debeActualizarYRetornarDTO() {
<span class="fc" id="L184">        contactoRequestDTO.setNombre(&quot;Juan Pérez Actualizado&quot;);</span>
<span class="fc" id="L185">        when(contactoRepository.findByContactoIDAndActivoTrue(1L)).thenReturn(Optional.of(contacto));</span>
<span class="fc" id="L186">        when(contactoRepository.existsByNombreIgnoreCaseAndTipoAndContactoIDNot(anyString(), any(TipoContacto.class), anyLong())).thenReturn(false);</span>
<span class="fc" id="L187">        when(contactoRepository.save(any(Contacto.class))).thenReturn(contacto);</span>

<span class="fc" id="L189">        ContactoDTO resultado = contactoService.actualizarContacto(1L, contactoRequestDTO);</span>

<span class="fc" id="L191">        assertNotNull(resultado);</span>
<span class="fc" id="L192">        verify(contactoRepository, times(1)).save(any(Contacto.class));</span>
<span class="fc" id="L193">    }</span>

    @Test
    @DisplayName(&quot;Eliminar contacto - debe cambiar activo a false&quot;)
    void eliminarContacto_debeCambiarActivoAFalse() {
<span class="fc" id="L198">        when(contactoRepository.findByContactoIDAndActivoTrue(1L)).thenReturn(Optional.of(contacto));</span>
<span class="fc" id="L199">        when(contactoRepository.save(any(Contacto.class))).thenReturn(contacto);</span>

<span class="fc" id="L201">        contactoService.eliminarContacto(1L);</span>

<span class="fc" id="L203">        verify(contactoRepository, times(1)).save(any(Contacto.class));</span>
<span class="fc" id="L204">    }</span>

    @Test
    @DisplayName(&quot;Reactivar contacto - debe cambiar activo a true&quot;)
    void reactivarContacto_debeCambiarActivoATrue() {
<span class="fc" id="L209">        contacto.setActivo(false);</span>
<span class="fc" id="L210">        when(contactoRepository.findById(1L)).thenReturn(Optional.of(contacto));</span>
<span class="fc" id="L211">        when(contactoRepository.save(any(Contacto.class))).thenReturn(contacto);</span>

<span class="fc" id="L213">        ContactoDTO resultado = contactoService.reactivarContacto(1L);</span>

<span class="fc" id="L215">        assertNotNull(resultado);</span>
<span class="fc" id="L216">        verify(contactoRepository, times(1)).save(any(Contacto.class));</span>
<span class="fc" id="L217">    }</span>

    @Test
    @DisplayName(&quot;Reactivar contacto ya activo - debe lanzar excepción&quot;)
    void reactivarContacto_yaActivo_debeLanzarExcepcion() {
<span class="fc" id="L222">        when(contactoRepository.findById(1L)).thenReturn(Optional.of(contacto));</span>

<span class="fc" id="L224">        RuntimeException exception = assertThrows(RuntimeException.class, () -&gt; {</span>
<span class="nc" id="L225">            contactoService.reactivarContacto(1L);</span>
<span class="nc" id="L226">        });</span>

<span class="fc" id="L228">        assertTrue(exception.getMessage().contains(&quot;ya está activo&quot;));</span>
<span class="fc" id="L229">    }</span>

    @Test
    @DisplayName(&quot;Buscar contactos por nombre - debe retornar coincidencias&quot;)
    void buscarContactosPorNombre_debeRetornarCoincidencias() {
<span class="fc" id="L234">        when(contactoRepository.findByNombreContainingIgnoreCaseAndActivoTrue(&quot;Juan&quot;)).thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L236">        List&lt;ContactoDTO&gt; resultado = contactoService.buscarContactosPorNombre(&quot;Juan&quot;);</span>

<span class="fc" id="L238">        assertNotNull(resultado);</span>
<span class="fc" id="L239">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L240">        verify(contactoRepository, times(1)).findByNombreContainingIgnoreCaseAndActivoTrue(&quot;Juan&quot;);</span>
<span class="fc" id="L241">    }</span>

    @Test
    @DisplayName(&quot;Buscar clientes por nombre - debe retornar solo clientes&quot;)
    void buscarClientes_debeRetornarSoloClientes() {
<span class="fc" id="L246">        when(contactoRepository.findByNombreContainingIgnoreCaseAndTipoAndActivoTrue(&quot;Juan&quot;, TipoContacto.CLIENTE))</span>
<span class="fc" id="L247">            .thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L249">        List&lt;ContactoDTO&gt; resultado = contactoService.buscarClientes(&quot;Juan&quot;);</span>

<span class="fc" id="L251">        assertNotNull(resultado);</span>
<span class="fc" id="L252">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L253">        assertEquals(TipoContacto.CLIENTE, resultado.get(0).getTipo());</span>
<span class="fc" id="L254">    }</span>

    @Test
    @DisplayName(&quot;Buscar empresas por nombre - debe retornar solo empresas&quot;)
    void buscarEmpresas_debeRetornarSoloEmpresas() {
<span class="fc" id="L259">        when(contactoRepository.findByNombreContainingIgnoreCaseAndTipoAndActivoTrue(&quot;Empresa&quot;, TipoContacto.EMPRESA))</span>
<span class="fc" id="L260">            .thenReturn(Arrays.asList(empresa));</span>

<span class="fc" id="L262">        List&lt;ContactoDTO&gt; resultado = contactoService.buscarEmpresas(&quot;Empresa&quot;);</span>

<span class="fc" id="L264">        assertNotNull(resultado);</span>
<span class="fc" id="L265">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L266">        assertEquals(TipoContacto.EMPRESA, resultado.get(0).getTipo());</span>
<span class="fc" id="L267">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPorTipo - con activo=true retorna solo activos&quot;)
    void obtenerContactosPorTipo_activoTrue_retornaSoloActivos() {
<span class="fc" id="L272">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.CLIENTE))</span>
<span class="fc" id="L273">            .thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L275">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPorTipo(TipoContacto.CLIENTE, true);</span>

<span class="fc" id="L277">        assertNotNull(resultado);</span>
<span class="fc" id="L278">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L279">        verify(contactoRepository, times(1)).findByTipoAndActivoTrue(TipoContacto.CLIENTE);</span>
<span class="fc" id="L280">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPorTipo - con activo=false retorna solo inactivos&quot;)
    void obtenerContactosPorTipo_activoFalse_retornaSoloInactivos() {
<span class="fc" id="L285">        Contacto contactoInactivo = new Contacto();</span>
<span class="fc" id="L286">        contactoInactivo.setContactoID(3L);</span>
<span class="fc" id="L287">        contactoInactivo.setNombre(&quot;Inactivo&quot;);</span>
<span class="fc" id="L288">        contactoInactivo.setTipo(TipoContacto.CLIENTE);</span>
<span class="fc" id="L289">        contactoInactivo.setActivo(false);</span>

<span class="fc" id="L291">        when(contactoRepository.findByTipoAndActivoFalse(TipoContacto.CLIENTE))</span>
<span class="fc" id="L292">            .thenReturn(Arrays.asList(contactoInactivo));</span>

<span class="fc" id="L294">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPorTipo(TipoContacto.CLIENTE, false);</span>

<span class="fc" id="L296">        assertNotNull(resultado);</span>
<span class="fc" id="L297">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L298">        verify(contactoRepository, times(1)).findByTipoAndActivoFalse(TipoContacto.CLIENTE);</span>
<span class="fc" id="L299">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPorTipo - con activo=null retorna todos&quot;)
    void obtenerContactosPorTipo_activoNull_retornaTodos() {
<span class="fc" id="L304">        when(contactoRepository.findByTipo(TipoContacto.CLIENTE))</span>
<span class="fc" id="L305">            .thenReturn(Arrays.asList(contacto, empresa));</span>

<span class="fc" id="L307">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPorTipo(TipoContacto.CLIENTE, null);</span>

<span class="fc" id="L309">        assertNotNull(resultado);</span>
<span class="fc" id="L310">        assertEquals(2, resultado.size());</span>
<span class="fc" id="L311">        verify(contactoRepository, times(1)).findByTipo(TipoContacto.CLIENTE);</span>
<span class="fc" id="L312">    }</span>

    @Test
    @DisplayName(&quot;obtenerEmpresas - con activo=true retorna solo empresas activas&quot;)
    void obtenerEmpresas_activoTrue_retornaSoloActivas() {
<span class="fc" id="L317">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.EMPRESA))</span>
<span class="fc" id="L318">            .thenReturn(Arrays.asList(empresa));</span>

<span class="fc" id="L320">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerEmpresas(true);</span>

<span class="fc" id="L322">        assertNotNull(resultado);</span>
<span class="fc" id="L323">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L324">        assertEquals(TipoContacto.EMPRESA, resultado.get(0).getTipo());</span>
<span class="fc" id="L325">    }</span>

    @Test
    @DisplayName(&quot;obtenerEmpresas - con activo=false retorna solo empresas inactivas&quot;)
    void obtenerEmpresas_activoFalse_retornaInactivas() {
<span class="fc" id="L330">        Contacto empresaInactiva = new Contacto();</span>
<span class="fc" id="L331">        empresaInactiva.setContactoID(4L);</span>
<span class="fc" id="L332">        empresaInactiva.setNombre(&quot;Empresa Inactiva&quot;);</span>
<span class="fc" id="L333">        empresaInactiva.setTipo(TipoContacto.EMPRESA);</span>
<span class="fc" id="L334">        empresaInactiva.setActivo(false);</span>

<span class="fc" id="L336">        when(contactoRepository.findByTipoAndActivoFalse(TipoContacto.EMPRESA))</span>
<span class="fc" id="L337">            .thenReturn(Arrays.asList(empresaInactiva));</span>

<span class="fc" id="L339">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerEmpresas(false);</span>

<span class="fc" id="L341">        assertNotNull(resultado);</span>
<span class="fc" id="L342">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L343">    }</span>

    @Test
    @DisplayName(&quot;obtenerEmpresas - con activo=null retorna todas&quot;)
    void obtenerEmpresas_activoNull_retornaTodas() {
<span class="fc" id="L348">        when(contactoRepository.findByTipo(TipoContacto.EMPRESA))</span>
<span class="fc" id="L349">            .thenReturn(Arrays.asList(empresa));</span>

<span class="fc" id="L351">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerEmpresas(null);</span>

<span class="fc" id="L353">        assertNotNull(resultado);</span>
<span class="fc" id="L354">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L355">    }</span>

    @Test
    @DisplayName(&quot;obtenerClientes - con activo=true retorna solo clientes activos&quot;)
    void obtenerClientes_activoTrue_retornaSoloActivos() {
<span class="fc" id="L360">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.CLIENTE))</span>
<span class="fc" id="L361">            .thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L363">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerClientes(true);</span>

<span class="fc" id="L365">        assertNotNull(resultado);</span>
<span class="fc" id="L366">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L367">        assertEquals(TipoContacto.CLIENTE, resultado.get(0).getTipo());</span>
<span class="fc" id="L368">    }</span>

    @Test
    @DisplayName(&quot;obtenerClientes - con activo=false retorna solo clientes inactivos&quot;)
    void obtenerClientes_activoFalse_retornaInactivos() {
<span class="fc" id="L373">        Contacto clienteInactivo = new Contacto();</span>
<span class="fc" id="L374">        clienteInactivo.setContactoID(5L);</span>
<span class="fc" id="L375">        clienteInactivo.setNombre(&quot;Cliente Inactivo&quot;);</span>
<span class="fc" id="L376">        clienteInactivo.setTipo(TipoContacto.CLIENTE);</span>
<span class="fc" id="L377">        clienteInactivo.setActivo(false);</span>

<span class="fc" id="L379">        when(contactoRepository.findByTipoAndActivoFalse(TipoContacto.CLIENTE))</span>
<span class="fc" id="L380">            .thenReturn(Arrays.asList(clienteInactivo));</span>

<span class="fc" id="L382">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerClientes(false);</span>

<span class="fc" id="L384">        assertNotNull(resultado);</span>
<span class="fc" id="L385">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L386">    }</span>

    @Test
    @DisplayName(&quot;obtenerClientes - con activo=null retorna todos&quot;)
    void obtenerClientes_activoNull_retornaTodos() {
<span class="fc" id="L391">        when(contactoRepository.findByTipo(TipoContacto.CLIENTE))</span>
<span class="fc" id="L392">            .thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L394">        List&lt;ContactoDTO&gt; resultado = contactoService.obtenerClientes(null);</span>

<span class="fc" id="L396">        assertNotNull(resultado);</span>
<span class="fc" id="L397">        assertEquals(1, resultado.size());</span>
<span class="fc" id="L398">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - sin filtros retorna todos activos&quot;)
    void obtenerContactosPaginadosConFiltros_sinFiltros_retornaTodosActivos() {
<span class="fc" id="L403">        Pageable pageable = PageRequest.of(0, 10);</span>
<span class="fc" id="L404">        Page&lt;Contacto&gt; contactoPage = new PageImpl&lt;&gt;(Arrays.asList(contacto, empresa));</span>

<span class="fc" id="L406">        when(contactoRepository.findByActivoTrueOrderByNombreAsc(pageable)).thenReturn(contactoPage);</span>

<span class="fc" id="L408">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L409">            pageable, null, true, null);</span>

<span class="fc" id="L411">        assertNotNull(resultado);</span>
<span class="fc" id="L412">        assertEquals(2, resultado.getTotalElements());</span>
<span class="fc" id="L413">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con tipo CLIENTE&quot;)
    void obtenerContactosPaginadosConFiltros_conTipoCliente() {
<span class="fc" id="L418">        Pageable pageable = PageRequest.of(0, 10);</span>
<span class="fc" id="L419">        Page&lt;Contacto&gt; contactoPage = new PageImpl&lt;&gt;(Arrays.asList(contacto));</span>

<span class="fc" id="L421">        when(contactoRepository.findByTipoAndActivoTrueOrderByNombreAsc(TipoContacto.CLIENTE, pageable))</span>
<span class="fc" id="L422">            .thenReturn(contactoPage);</span>

<span class="fc" id="L424">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L425">            pageable, null, true, TipoContacto.CLIENTE);</span>

<span class="fc" id="L427">        assertNotNull(resultado);</span>
<span class="fc" id="L428">        assertEquals(1, resultado.getTotalElements());</span>
<span class="fc" id="L429">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con tipo EMPRESA&quot;)
    void obtenerContactosPaginadosConFiltros_conTipoEmpresa() {
<span class="fc" id="L434">        Pageable pageable = PageRequest.of(0, 10);</span>
<span class="fc" id="L435">        Page&lt;Contacto&gt; contactoPage = new PageImpl&lt;&gt;(Arrays.asList(empresa));</span>

<span class="fc" id="L437">        when(contactoRepository.findByTipoAndActivoTrueOrderByNombreAsc(TipoContacto.EMPRESA, pageable))</span>
<span class="fc" id="L438">            .thenReturn(contactoPage);</span>

<span class="fc" id="L440">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L441">            pageable, null, true, TipoContacto.EMPRESA);</span>

<span class="fc" id="L443">        assertNotNull(resultado);</span>
<span class="fc" id="L444">        assertEquals(1, resultado.getTotalElements());</span>
<span class="fc" id="L445">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con searchTerm&quot;)
    void obtenerContactosPaginadosConFiltros_conSearchTerm() {
<span class="fc" id="L450">        Pageable pageable = PageRequest.of(0, 10);</span>

<span class="fc" id="L452">        when(contactoRepository.findByActivoTrue()).thenReturn(Arrays.asList(contacto, empresa));</span>

<span class="fc" id="L454">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L455">            pageable, &quot;Juan&quot;, true, null);</span>

<span class="fc" id="L457">        assertNotNull(resultado);</span>
        // Debe filtrar solo los que coinciden con &quot;Juan&quot;
<span class="fc" id="L459">        assertEquals(1, resultado.getContent().size());</span>
<span class="fc" id="L460">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con activo=false&quot;)
    void obtenerContactosPaginadosConFiltros_activoFalse() {
<span class="fc" id="L465">        Pageable pageable = PageRequest.of(0, 10);</span>
<span class="fc" id="L466">        Page&lt;Contacto&gt; contactoPage = new PageImpl&lt;&gt;(Arrays.asList());</span>

<span class="fc" id="L468">        when(contactoRepository.findByActivoFalseOrderByNombreAsc(pageable)).thenReturn(contactoPage);</span>

<span class="fc" id="L470">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L471">            pageable, null, false, null);</span>

<span class="fc" id="L473">        assertNotNull(resultado);</span>
<span class="fc" id="L474">        verify(contactoRepository, times(1)).findByActivoFalseOrderByNombreAsc(pageable);</span>
<span class="fc" id="L475">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con activo=null retorna todos&quot;)
    void obtenerContactosPaginadosConFiltros_activoNull_retornaTodos() {
<span class="fc" id="L480">        Pageable pageable = PageRequest.of(0, 10);</span>
<span class="fc" id="L481">        Page&lt;Contacto&gt; contactoPage = new PageImpl&lt;&gt;(Arrays.asList(contacto, empresa));</span>

<span class="fc" id="L483">        when(contactoRepository.findAllByOrderByNombreAsc(pageable)).thenReturn(contactoPage);</span>

<span class="fc" id="L485">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L486">            pageable, null, null, null);</span>

<span class="fc" id="L488">        assertNotNull(resultado);</span>
<span class="fc" id="L489">        assertEquals(2, resultado.getTotalElements());</span>
<span class="fc" id="L490">    }</span>

    @Test
    @DisplayName(&quot;obtenerContactosPaginadosConFiltros - con tipo y searchTerm&quot;)
    void obtenerContactosPaginadosConFiltros_conTipoYSearchTerm() {
<span class="fc" id="L495">        Pageable pageable = PageRequest.of(0, 10);</span>

<span class="fc" id="L497">        when(contactoRepository.findByTipoAndActivoTrue(TipoContacto.CLIENTE))</span>
<span class="fc" id="L498">            .thenReturn(Arrays.asList(contacto));</span>

<span class="fc" id="L500">        Page&lt;ContactoDTO&gt; resultado = contactoService.obtenerContactosPaginadosConFiltros(</span>
<span class="fc" id="L501">            pageable, &quot;Juan&quot;, true, TipoContacto.CLIENTE);</span>

<span class="fc" id="L503">        assertNotNull(resultado);</span>
<span class="fc" id="L504">        assertEquals(1, resultado.getContent().size());</span>
<span class="fc" id="L505">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>