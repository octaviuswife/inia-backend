<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RepTetrazolioViabilidadController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.controllers</a> &gt; <span class="el_source">RepTetrazolioViabilidadController.java</span></div><h1>RepTetrazolioViabilidadController.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.controllers;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.request.RepTetrazolioViabilidadRequestDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.response.RepTetrazolioViabilidadDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.services.RepTetrazolioViabilidadService;

// CORS configurado globalmente en WebSecurityConfig
@RestController
@RequestMapping(&quot;/api/tetrazolios/{tetrazolioId}/repeticiones&quot;)
@Tag(name = &quot;Repeticiones Tetrazolio Viabilidad&quot;, description = &quot;API para gestión de repeticiones de análisis de tetrazolio viabilidad&quot;)
@SecurityRequirement(name = &quot;bearerAuth&quot;)
<span class="fc" id="L30">public class RepTetrazolioViabilidadController {</span>

    @Autowired
    private RepTetrazolioViabilidadService repeticionService;

    // Crear nueva repetición para un tetrazolio específico
    @Operation(summary = &quot;Crear repetición de tetrazolio viabilidad&quot;, 
              description = &quot;Crea una nueva repetición para un análisis de tetrazolio viabilidad específico&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA')&quot;)
    @PostMapping
    public ResponseEntity&lt;RepTetrazolioViabilidadDTO&gt; crearRepeticion(
            @PathVariable Long tetrazolioId,
            @RequestBody RepTetrazolioViabilidadRequestDTO solicitud) {
<span class="fc" id="L43">        RepTetrazolioViabilidadDTO repeticionCreada = repeticionService.crearRepeticion(tetrazolioId, solicitud);</span>
<span class="fc" id="L44">        return ResponseEntity.status(HttpStatus.CREATED).body(repeticionCreada);</span>
    }

    // Obtener todas las repeticiones de un tetrazolio
    @Operation(summary = &quot;Listar repeticiones de tetrazolio viabilidad&quot;, 
              description = &quot;Obtiene todas las repeticiones asociadas a un análisis de tetrazolio viabilidad específico&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @GetMapping
    public ResponseEntity&lt;List&lt;RepTetrazolioViabilidadDTO&gt;&gt; obtenerRepeticionesPorTetrazolio(@PathVariable Long tetrazolioId) {
<span class="fc" id="L53">        List&lt;RepTetrazolioViabilidadDTO&gt; repeticiones = repeticionService.obtenerRepeticionesPorTetrazolio(tetrazolioId);</span>
<span class="fc" id="L54">        return ResponseEntity.ok(repeticiones);</span>
    }

    // Contar repeticiones de un tetrazolio
    @Operation(summary = &quot;Contar repeticiones de tetrazolio viabilidad&quot;, 
              description = &quot;Cuenta el número de repeticiones asociadas a un análisis de tetrazolio viabilidad específico&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @GetMapping(&quot;/count&quot;)
    public ResponseEntity&lt;Long&gt; contarRepeticionesPorTetrazolio(@PathVariable Long tetrazolioId) {
<span class="fc" id="L63">        Long count = repeticionService.contarRepeticionesPorTetrazolio(tetrazolioId);</span>
<span class="fc" id="L64">        return ResponseEntity.ok(count);</span>
    }

    // Obtener repetición específica por ID (ruta alternativa fuera del contexto del tetrazolio)
    @Operation(summary = &quot;Obtener repetición de tetrazolio viabilidad por ID&quot;, 
              description = &quot;Obtiene una repetición específica de un análisis de tetrazolio viabilidad por su ID&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @GetMapping(&quot;/{repeticionId}&quot;)
    public ResponseEntity&lt;RepTetrazolioViabilidadDTO&gt; obtenerRepeticionPorId(
            @PathVariable Long tetrazolioId,
            @PathVariable Long repeticionId) {
<span class="fc" id="L75">        RepTetrazolioViabilidadDTO repeticion = repeticionService.obtenerRepeticionPorId(repeticionId);</span>
<span class="fc" id="L76">        return ResponseEntity.ok(repeticion);</span>
    }

    // Actualizar repetición específica
    @Operation(summary = &quot;Actualizar repetición de tetrazolio viabilidad&quot;, 
              description = &quot;Actualiza una repetición específica de un análisis de tetrazolio viabilidad&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA')&quot;)
    @PutMapping(&quot;/{repeticionId}&quot;)
    public ResponseEntity&lt;RepTetrazolioViabilidadDTO&gt; actualizarRepeticion(
            @PathVariable Long tetrazolioId,
            @PathVariable Long repeticionId,
            @RequestBody RepTetrazolioViabilidadRequestDTO solicitud) {
<span class="fc" id="L88">        RepTetrazolioViabilidadDTO repeticionActualizada = repeticionService.actualizarRepeticion(repeticionId, solicitud);</span>
<span class="fc" id="L89">        return ResponseEntity.ok(repeticionActualizada);</span>
    }

    // Eliminar repetición específica (eliminación real)
    @Operation(summary = &quot;Eliminar repetición de tetrazolio viabilidad&quot;, 
              description = &quot;Elimina una repetición específica de un análisis de tetrazolio viabilidad (eliminación física)&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    @DeleteMapping(&quot;/{repeticionId}&quot;)
    public ResponseEntity&lt;Void&gt; eliminarRepeticion(
            @PathVariable Long tetrazolioId,
            @PathVariable Long repeticionId) {
<span class="fc" id="L100">        repeticionService.eliminarRepeticion(repeticionId);</span>
<span class="fc" id="L101">        return ResponseEntity.noContent().build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>