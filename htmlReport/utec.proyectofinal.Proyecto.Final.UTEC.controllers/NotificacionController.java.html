<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NotificacionController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in Proyecto-Final-UTEC Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepPmsControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, RepTetrazolioViabilidadControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, Auth2FAControllerIntegrationTest Coverage Results, java in Proyecto-Final-UTEC Coverage Results</a> &gt; <a href="index.source.html" class="el_package">utec.proyectofinal.Proyecto.Final.UTEC.controllers</a> &gt; <span class="el_source">NotificacionController.java</span></div><h1>NotificacionController.java</h1><pre class="source lang-java linenums">package utec.proyectofinal.Proyecto.Final.UTEC.controllers;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.request.NotificacionRequestDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.dtos.response.NotificacionDTO;
import utec.proyectofinal.Proyecto.Final.UTEC.services.NotificacionService;

// CORS configurado globalmente en WebSecurityConfig
@RestController
@RequestMapping(&quot;/api/notificaciones&quot;)
@Tag(name = &quot;Notificaciones&quot;, description = &quot;Gestión de notificaciones del sistema&quot;)
<span class="fc" id="L32">public class NotificacionController {</span>

    @Autowired
    private NotificacionService notificacionService;

    // Crear notificación manual
    @PostMapping
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    @Operation(summary = &quot;Crear notificación manual&quot;, description = &quot;Crear una notificación manual (solo administradores)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;NotificacionDTO&gt; crearNotificacion(@RequestBody NotificacionRequestDTO request) {
<span class="fc" id="L43">        NotificacionDTO notificacion = notificacionService.crearNotificacion(request);</span>
<span class="fc" id="L44">        return ResponseEntity.ok(notificacion);</span>
    }

    // Obtener notificaciones de un usuario con paginación
    @GetMapping(&quot;/usuario/{usuarioId}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Obtener notificaciones por usuario&quot;, description = &quot;Obtener notificaciones de un usuario con paginación (solo admins pueden ver otras notificaciones)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Page&lt;NotificacionDTO&gt;&gt; obtenerNotificacionesPorUsuario(
            @PathVariable Long usuarioId,
            @RequestParam(defaultValue = &quot;0&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size) {
        
<span class="fc" id="L57">        Pageable pageable = PageRequest.of(page, size);</span>
<span class="fc" id="L58">        Page&lt;NotificacionDTO&gt; notificaciones = notificacionService.obtenerNotificacionesPorUsuarioConValidacion(usuarioId, pageable);</span>
<span class="fc" id="L59">        return ResponseEntity.ok(notificaciones);</span>
    }

    // Obtener MIS notificaciones con paginación (usuario actual)
    @GetMapping(&quot;/mis-notificaciones&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Obtener mis notificaciones&quot;, description = &quot;Obtener notificaciones del usuario autenticado con paginación&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Page&lt;NotificacionDTO&gt;&gt; obtenerMisNotificaciones(
            @RequestParam(defaultValue = &quot;0&quot;) int page,
            @RequestParam(defaultValue = &quot;10&quot;) int size) {
        
<span class="fc" id="L71">        Pageable pageable = PageRequest.of(page, size);</span>
<span class="fc" id="L72">        Page&lt;NotificacionDTO&gt; notificaciones = notificacionService.obtenerMisNotificaciones(pageable);</span>
<span class="fc" id="L73">        return ResponseEntity.ok(notificaciones);</span>
    }

    // Obtener notificaciones no leídas de un usuario
    @GetMapping(&quot;/usuario/{usuarioId}/no-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Obtener notificaciones no leídas&quot;, description = &quot;Obtener notificaciones no leídas de un usuario (solo admins pueden ver otras notificaciones)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;List&lt;NotificacionDTO&gt;&gt; obtenerNotificacionesNoLeidas(@PathVariable Long usuarioId) {
<span class="fc" id="L82">        List&lt;NotificacionDTO&gt; notificaciones = notificacionService.obtenerNotificacionesNoLeidasConValidacion(usuarioId);</span>
<span class="fc" id="L83">        return ResponseEntity.ok(notificaciones);</span>
    }

    // Obtener MIS notificaciones no leídas (usuario actual)
    @GetMapping(&quot;/mis-notificaciones/no-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Obtener mis notificaciones no leídas&quot;, description = &quot;Obtener notificaciones no leídas del usuario autenticado&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;List&lt;NotificacionDTO&gt;&gt; obtenerMisNotificacionesNoLeidas() {
<span class="fc" id="L92">        List&lt;NotificacionDTO&gt; notificaciones = notificacionService.obtenerMisNotificacionesNoLeidas();</span>
<span class="fc" id="L93">        return ResponseEntity.ok(notificaciones);</span>
    }

    // Contar notificaciones no leídas
    @GetMapping(&quot;/usuario/{usuarioId}/contar-no-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Contar notificaciones no leídas&quot;, description = &quot;Contar el número de notificaciones no leídas de un usuario (solo admins pueden ver otras notificaciones)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Long&gt; contarNotificacionesNoLeidas(@PathVariable Long usuarioId) {
<span class="fc" id="L102">        Long count = notificacionService.contarNotificacionesNoLeidasConValidacion(usuarioId);</span>
<span class="fc" id="L103">        return ResponseEntity.ok(count);</span>
    }

    // Contar MIS notificaciones no leídas (usuario actual)
    @GetMapping(&quot;/mis-notificaciones/contar-no-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Contar mis notificaciones no leídas&quot;, description = &quot;Contar el número de notificaciones no leídas del usuario autenticado&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Long&gt; contarMisNotificacionesNoLeidas() {
<span class="fc" id="L112">        Long count = notificacionService.contarMisNotificacionesNoLeidas();</span>
<span class="fc" id="L113">        return ResponseEntity.ok(count);</span>
    }

    // Marcar notificación como leída
    @PutMapping(&quot;/{notificacionId}/marcar-leida&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Marcar notificación como leída&quot;, description = &quot;Marcar una notificación específica como leída&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;NotificacionDTO&gt; marcarComoLeida(@PathVariable Long notificacionId) {
<span class="fc" id="L122">        NotificacionDTO notificacion = notificacionService.marcarComoLeida(notificacionId);</span>
<span class="fc" id="L123">        return ResponseEntity.ok(notificacion);</span>
    }

    // Marcar todas las notificaciones de un usuario como leídas
    @PutMapping(&quot;/usuario/{usuarioId}/marcar-todas-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Marcar todas como leídas&quot;, description = &quot;Marcar todas las notificaciones de un usuario como leídas (solo admins pueden marcar otras notificaciones)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Void&gt; marcarTodasComoLeidas(@PathVariable Long usuarioId) {
<span class="fc" id="L132">        notificacionService.marcarTodasComoLeidasConValidacion(usuarioId);</span>
<span class="fc" id="L133">        return ResponseEntity.ok().build();</span>
    }

    // Marcar todas MIS notificaciones como leídas (usuario actual)
    @PutMapping(&quot;/mis-notificaciones/marcar-todas-leidas&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Marcar todas mis notificaciones como leídas&quot;, description = &quot;Marcar todas las notificaciones del usuario autenticado como leídas&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Void&gt; marcarTodasMisNotificacionesComoLeidas() {
<span class="fc" id="L142">        notificacionService.marcarTodasMisNotificacionesComoLeidas();</span>
<span class="fc" id="L143">        return ResponseEntity.ok().build();</span>
    }

    // Eliminar notificación (marcar como inactiva)
    @DeleteMapping(&quot;/{notificacionId}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN') or hasRole('ANALISTA') or hasRole('OBSERVADOR')&quot;)
    @Operation(summary = &quot;Eliminar notificación&quot;, description = &quot;Eliminar una notificación (marcar como inactiva)&quot;)
    @SecurityRequirement(name = &quot;bearerAuth&quot;)
    public ResponseEntity&lt;Void&gt; eliminarNotificacion(@PathVariable Long notificacionId) {
<span class="fc" id="L152">        notificacionService.eliminarNotificacion(notificacionId);</span>
<span class="fc" id="L153">        return ResponseEntity.ok().build();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>